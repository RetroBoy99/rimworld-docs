<div class="type-view">
  <div *ngIf="loading()" class="loading">
    <div class="spinner"></div>
    <p>Loading type information...</p>
  </div>
  
  <div *ngIf="!loading() && error()" class="error">
    <h2>Error</h2>
    <p>{{ error() }}</p>
    <a routerLink="/docs" class="back-btn">Back to Documentation</a>
  </div>
  
  <div *ngIf="!loading() && !error() && type()">
    <div class="type-header">
      <div class="breadcrumb">
        <a routerLink="/docs">Documentation</a>
        <span class="separator">/</span>
        <a [routerLink]="getCategoryRoute()">{{ getCategoryDisplayName() }}</a>
        <span class="separator">/</span>
        <span class="current">{{ type()!.name }}</span>
      </div>

      <div class="type-info">
        <div class="type-icon">{{ getTypeIcon(type()!) }}</div>
        <div class="type-details">
          <h1>{{ type()!.name }}</h1>
          <div class="type-meta">
            <span class="type-kind">{{ type()!.kind }}</span>
            <span class="file-info">{{ type()!.file }}:{{ type()!.line }}</span>
            <span class="member-count">{{ type()!.member_count }} members</span>
          </div>
          
          <div class="type-modifiers" *ngIf="type()!.modifiers && type()!.modifiers.length > 0">
            <span class="label">Modifiers:</span>
            <span *ngFor="let modifier of type()!.modifiers" class="modifier-tag">{{ modifier }}</span>
          </div>
          
          <div class="base-types" *ngIf="type()!.base_types && type()!.base_types.length > 0">
            <span class="label">Inherits from:</span>
            <a 
              *ngFor="let baseType of type()!.base_types" 
              [routerLink]="typeExists(baseType) ? ['/docs/type', baseType] : null"
              [class]="typeExists(baseType) ? 'base-type-link' : 'base-type-tag'"
              [title]="typeExists(baseType) ? 'Go to ' + baseType : baseType + ' (external type)'"
            >
              {{ baseType }}
            </a>
          </div>
          
          <div class="derived-types" *ngIf="getDerivedTypes().length > 0">
            <div class="derived-types-header" (click)="toggleDerivedTypes()">
              <span class="label">ðŸ”½ Inherited by {{ getDerivedTypes().length }} type{{ getDerivedTypes().length !== 1 ? 's' : '' }}</span>
              <span class="toggle-icon">{{ isDerivedTypesExpanded() ? 'â–¼' : 'â–¶' }}</span>
            </div>
            
            <div *ngIf="isDerivedTypesExpanded()" class="derived-types-list">
              <a 
                *ngFor="let derivedType of getDerivedTypes()"
                [routerLink]="typeExists(derivedType) ? ['/docs/type', derivedType] : null"
                [class]="typeExists(derivedType) ? 'derived-type-link' : 'derived-type-tag'"
                [title]="typeExists(derivedType) ? 'Go to ' + derivedType : derivedType + ' (external type)'"
              >
                {{ derivedType }}
              </a>
            </div>
          </div>
        </div>
      </div>
    </div>

    <div class="type-content">
      <div *ngIf="type()!.members.length > 0" class="members-section">
        <div class="members-header">
          <h2>Members ({{ getFilteredMemberCount() }} of {{ type()!.members.length }})</h2>
          
          <!-- Member filters -->
          <div class="member-filters">
            <span class="filter-label">Filter by:</span>
            <div class="filter-buttons">
              <button 
                *ngFor="let kind of getAllMemberKinds()"
                class="filter-btn"
                [class.active]="isMemberFilterActive(kind)"
                (click)="toggleMemberFilter(kind)"
                [title]="'Toggle ' + kind + ' members'"
              >
                <span class="filter-icon">{{ getMemberIcon({kind: kind}) }}</span>
                {{ kind }}
                <span class="filter-count">({{ getMemberKindCounts()[kind] || 0 }})</span>
              </button>
            </div>
          </div>
        </div>
        
        <div class="members-list">
          <div *ngFor="let member of getFilteredMembers(); trackBy: trackBySignature" class="member-item" [id]="getMemberAnchorId(member)">
            <div class="member-header">
              <span class="member-icon">{{ getMemberIcon(member) }}</span>
              <span class="member-kind">{{ member.kind }}</span>
              <span class="member-name">{{ member.name }}</span>
              <span class="member-line">Line {{ member.line }}</span>
              <button 
                class="copy-link-btn" 
                (click)="copyMemberLink(member)"
                [title]="'Copy link to ' + member.name"
                type="button"
              >
                ðŸ“‹
              </button>
            </div>
            
            <div class="member-modifiers" *ngIf="member.modifiers && member.modifiers.length > 0">
              <span *ngFor="let modifier of member.modifiers" class="modifier-tag small">{{ modifier }}</span>
            </div>
            
            <div class="member-signature" [innerHTML]="formatSignature(member.signature)"></div>
            
            <div class="member-details">
              <div *ngIf="member.return_type" class="return-type-section">
                <span class="return-type">Returns: 
                  <a 
                    *ngIf="typeExists(member.return_type); else nonLinkReturnType"
                    [routerLink]="['/docs/type', member.return_type]"
                    class="return-type-link"
                    [title]="'Go to ' + member.return_type"
                  >
                    {{ member.return_type }}
                  </a>
                  <ng-template #nonLinkReturnType>
                    <code>{{ member.return_type }}</code>
                  </ng-template>
                </span>
              </div>

              <!-- Override Information -->
              <div *ngIf="getOverrideInfo(member.name) as overrideInfo" class="override-section">
                <!-- What this method overrides -->
                <div *ngIf="overrideInfo.overrides" class="overrides-info">
                  <span class="override-label">ðŸ”„ Overrides:</span>
                  <a 
                    [routerLink]="['/docs/type', parseMemberKey(overrideInfo.overrides).typeName]"
                    [fragment]="getMemberAnchorIdFromKey(overrideInfo.overrides)"
                    class="override-link"
                    [title]="'Go to base method in ' + parseMemberKey(overrideInfo.overrides).typeName"
                  >
                    {{ overrideInfo.overrides }}
                  </a>
                </div>

                <!-- What overrides this method -->
                <div *ngIf="overrideInfo.overriddenBy.length > 0" class="overridden-by-info">
                  <div class="overridden-by-header" (click)="toggleOverriddenBy(member.name)">
                    <span class="override-label">ðŸ”½ Overridden by {{ overrideInfo.overriddenBy.length }} class{{ overrideInfo.overriddenBy.length !== 1 ? 'es' : '' }}</span>
                    <span class="toggle-icon">{{ isOverriddenByExpanded(member.name) ? 'â–¼' : 'â–¶' }}</span>
                  </div>
                  
                  <div *ngIf="isOverriddenByExpanded(member.name)" class="overridden-by-list">
                    <a 
                      *ngFor="let overriddenBy of overrideInfo.overriddenBy"
                      [routerLink]="['/docs/type', parseMemberKey(overriddenBy).typeName]"
                      [fragment]="getMemberAnchorIdFromKey(overriddenBy)"
                      class="override-link"
                      [title]="'Go to overridden method in ' + parseMemberKey(overriddenBy).typeName"
                    >
                      {{ overriddenBy }}
                    </a>
                  </div>
                </div>
              </div>

              <div *ngIf="getReferencedTypes(member.signature).length > 0" class="referenced-types-section">
                <span class="referenced-types-label">Referenced Types:</span>
                <div class="referenced-types-list">
                  <a 
                    *ngFor="let typeRef of getReferencedTypes(member.signature)" 
                    [routerLink]="['/docs/type', typeRef.typeName]"
                    class="referenced-type-link"
                    [title]="'Go to ' + typeRef.typeName"
                  >
                    {{ typeRef.typeName }}
                  </a>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
      
      <div *ngIf="type()!.members.length === 0" class="no-members">
        <p>This {{ type()!.kind }} has no members.</p>
      </div>
      
      <div *ngIf="type()!.members.length > 0 && getFilteredMembers().length === 0" class="no-filtered-members">
        <p>No members match the current filters.</p>
        <button class="clear-filters-btn" (click)="memberFilters.set({method: true, property: true, field: true, constructor: true})">
          Clear Filters
        </button>
      </div>
    </div>
  </div>
</div>
