import{a as T,c as C,e as D,g as l,h as v,ha as M,k as _,m as I,p as w,s as m}from"./chunk-MR7FNOQB.js";var S=class y{constructor(e){this.http=e}docsData=m(null);categorizedData=m(null);loading=m(!1);error=m(null);loadedTypes=new Map;typeLoadingState=new D({});searchCache=new Map;PAGE_SIZE=50;SEARCH_RESULT_LIMIT=100;findTypeReferences(e){let t=/\b([A-Z][a-zA-Z0-9_]*(?:<[^>]+>)?)\b/g,s=[...e.matchAll(t)],n=new Set(s.map(r=>r[1]));return Array.from(n).map(r=>({typeName:this.cleanTypeName(r),exists:this.typeExists(this.cleanTypeName(r))}))}cleanTypeName(e){return e.split("<")[0]}typeExists(e){let t=this.categorizedData();return t?t.typeIndex.has(e):this.loadedTypes.size===0?/^[A-Z][a-zA-Z0-9_]*$/.test(e)&&e.length>2:this.getType(e)!==null}formatSignatureWithLinks(e){let t=e;return t=t.replace(/(public|private|protected|internal|static|override|virtual|abstract|readonly)/g,'<span class="keyword">$1</span>').replace(/(\w+)\s+(\w+)\s*\(/g,'<span class="return-type">$1</span> <span class="method-name">$2</span>(').replace(/(\w+)\s*:\s*(\w+)/g,'<span class="param-name">$1</span>: <span class="param-type">$2</span>'),t}getReferencedTypes(e){return this.findTypeReferences(e).filter(({typeName:s,exists:n})=>n&&s.length>2&&!["bool","void","string","int","object","float","double","long","short","byte","char"].includes(s.toLowerCase()))}loadDocs(){if(this.docsData())return l(this.docsData());this.loading.set(!0),this.error.set(null);let e=document.querySelector("base")?.href??"/",t=new URL("assets/docs_index.gz",e);return t.searchParams.set("v",String(window.__BUILD_ID__??Date.now())),this.http.get(t.toString()).pipe(v(s=>(this.docsData.set(s),this.loading.set(!1),this.storeFullDataForLazyLoading(s),s)),_(1))}storeFullDataForLazyLoading(e){this.loadedTypes.set("<global>",e.types),this.categorizedData.set(this.categorizeData(e))}categorizeData(e){let t={metadata:{generated_at:e.generated_at,total_types:e.total_types,total_members:e.total_members,type_counts:T({},e.type_counts)},categories:{classes:new Map,enums:new Map,interfaces:new Map,structs:new Map},typeIndex:new Map,memberIndex:new Map,inheritance:new Map,references:new Map,overrides:new Map};for(let s of e.types){switch(s.kind){case"class":t.categories.classes.set(s.name,s);break;case"enum":t.categories.enums.set(s.name,s);break;case"interface":t.categories.interfaces.set(s.name,s);break;case"struct":t.categories.structs.set(s.name,s);break}t.typeIndex.set(s.name,s),t.memberIndex.set(s.name,s.members),s.base_types&&s.base_types.length>0&&t.inheritance.set(s.name,s.base_types),this.buildCrossReferences(s,t.references)}return this.buildOverrideRelationships(t),t}buildCrossReferences(e,t){for(let s of e.members){let n=this.findTypeReferences(s.signature);for(let{typeName:r}of n)t.has(r)||t.set(r,new Set),t.get(r).add(e.name)}}buildOverrideRelationships(e){for(let t of e.typeIndex.values())if(!(!t.base_types||t.base_types.length===0)){for(let s of t.members)if(s.modifiers.includes("override")){let n=`${t.name}.${s.name}`,r=this.findOverriddenMethod(t,s,e);r&&e.overrides.set(n,{overrides:r,overriddenBy:[]})}}for(let[t,s]of e.overrides.entries())if(s.overrides){let n=s.overrides,r=e.overrides.get(n);r||(r={overriddenBy:[]},e.overrides.set(n,r)),r.overriddenBy.push(t)}}findOverriddenMethod(e,t,s){for(let n of e.base_types){let r=s.typeIndex.get(n);if(!r)continue;let o=r.members.find(c=>c.name===t.name&&(c.kind===t.kind||c.kind==="method"&&t.kind==="method"));if(o)return`${r.name}.${o.name}`;if(r.base_types&&r.base_types.length>0){let c=this.findOverriddenMethod(r,t,s);if(c)return c}}}getDocsData(){return this.docsData}getCategorizedData(){return this.categorizedData}getLoading(){return this.loading}getError(){return this.error}getTypesByCategory(e){let t=this.categorizedData();if(!t)return[];let s=t.categories[e==="class"?"classes":e==="enum"?"enums":e==="interface"?"interfaces":"structs"];return Array.from(s.values())}getTypesByCategoryPaginated(e,t=0){let s=this.getTypesByCategory(e),n=t*this.PAGE_SIZE,r=n+this.PAGE_SIZE;return l(s.slice(n,r))}getCategoryCount(e){let t=this.categorizedData();return t?t.metadata.type_counts[e]:0}getCategoryPageCount(e){let t=this.getCategoryCount(e);return Math.ceil(t/this.PAGE_SIZE)}getTypeReferences(e){let t=this.categorizedData();if(!t)return[];let s=t.references.get(e);return s?Array.from(s):[]}getAllCategories(){let e=this.categorizedData();return e?[{category:"class",count:e.metadata.type_counts.class,types:Array.from(e.categories.classes.values())},{category:"enum",count:e.metadata.type_counts.enum,types:Array.from(e.categories.enums.values())},{category:"interface",count:e.metadata.type_counts.interface,types:Array.from(e.categories.interfaces.values())},{category:"struct",count:e.metadata.type_counts.struct,types:Array.from(e.categories.structs.values())}]:[]}getCategoryDisplayName(e){switch(e){case"class":return"Classes";case"enum":return"Enums";case"interface":return"Interfaces";case"struct":return"Structs";default:return"Types"}}getCategoryRoute(e){return`/docs/category/${e}`}getInheritance(e){let t=this.categorizedData();if(!t)return[];let s=t.inheritance.get(e);return s||[]}getOverrideInfo(e,t){let s=this.categorizedData();if(!s)return null;let n=`${e}.${t}`;return s.overrides.get(n)||null}parseMemberKey(e){let t=e.lastIndexOf(".");return{typeName:e.substring(0,t),memberName:e.substring(t+1)}}getMemberFromKey(e){let t=this.parseMemberKey(e),s=this.categorizedData();if(!s||!t.typeName)return null;let n=s.memberIndex.get(t.typeName);return n&&n.find(r=>r.name===t.memberName)||null}getNamespaces(){let e=this.docsData();return e?[{name:"<global>",type_count:e.total_types,types:[]}]:[]}getNamespaceTypes(e,t=0){let s=this.loadedTypes.get(e)||[],n=t*this.PAGE_SIZE,r=n+this.PAGE_SIZE;return l(s.slice(n,r))}getNamespaceTypeCount(e){return(this.loadedTypes.get(e)||[]).length}getNamespacePageCount(e){let t=this.getNamespaceTypeCount(e);return Math.ceil(t/this.PAGE_SIZE)}getNamespace(e){let t=this.docsData();return t&&e==="<global>"?{name:"<global>",type_count:t.total_types,types:[]}:null}getType(e){let t=this.categorizedData();if(t){let s=t.typeIndex.get(e);if(s)return{type:s,namespace:"<global>",category:s.kind}}for(let[s,n]of this.loadedTypes.entries()){let r=n.find(o=>o.name===e);if(r)return{type:r,namespace:s,category:r.kind}}return null}getTypeAsync(e){let t=this.getType(e);return t?l(t):this.loadedTypes.size===0?this.loadDocs().pipe(v(()=>this.getType(e))):l(null)}search(e){if(!e.trim())return l([]);let t=e.toLowerCase();return this.searchCache.has(t)?(console.log("Search results from cache for:",e),l(this.searchCache.get(t))):(console.log("Starting search for:",e),new C(s=>{let n=[],r=e.toLowerCase(),o=0,c=()=>{let f=Array.from(this.loadedTypes.entries()),x=1;if(o>=f.length){let p=n.sort((h,b)=>b.relevance-h.relevance).slice(0,this.SEARCH_RESULT_LIMIT);this.searchCache.set(t,p),console.log(`Search completed: found ${p.length} results (limited from ${n.length})`),s.next(p),s.complete();return}for(let p=0;p<x&&o<f.length;p++){let[h,b]=f[o];for(let a of b){let i=0,u="name";if(a.name.toLowerCase().includes(r)&&(i+=10,a.name.toLowerCase().startsWith(r)&&(i+=5)),a.file.toLowerCase().includes(r)&&(i+=3,u="file"),a.access_modifier&&a.access_modifier.toLowerCase().includes(r)&&(i+=3),a.modifiers)for(let g of a.modifiers)g.toLowerCase().includes(r)&&(i+=3);let z=10;for(let g=0;g<Math.min(a.members.length,z);g++){let d=a.members[g];d.signature.toLowerCase().includes(r)&&(i+=2,u="signature"),d.name&&d.name.toLowerCase().includes(r)&&(i+=3,u="signature"),d.return_type&&d.return_type.toLowerCase().includes(r)&&(i+=2,u="signature"),d.access_modifier&&d.access_modifier.toLowerCase().includes(r)&&(i+=2,u="signature")}i>0&&n.push({type:a,namespace:h,category:a.kind,matchType:u,relevance:i})}o++}setTimeout(c,0)};c()}))}static \u0275fac=function(t){return new(t||y)(w(M))};static \u0275prov=I({token:y,factory:y.\u0275fac,providedIn:"root"})};export{S as a};
